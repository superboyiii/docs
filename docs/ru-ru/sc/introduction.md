# Смарт-контракт NEO. Введение

## Что такое смарт-контракт?

Смарт-контракт - это набор обязательств, сформулированных в цифровом виде, а также соглашение, определяющее, каким образом стороны контракта будут выполнять данные обязательства. Блокчейн-технология предоставляет нам децентрализованную, защищенную от несанционированного вмешательства, высоконадежную систему, которая крайне удобна для применения смарт-контрактов. Смарт-контракты - одна из важнейших характеристик блокчейн-технологий, а также причина, по которой блокчейн можно смело назвать революционной технологией. Блокчейн ежедневно повышает эффективность взаимодействия между людьми в обществе.
 
## Какими характеристиками обладают смарт-контракты NEO?

NEO Smart Contract 2.0 обладает такими свойствами, как определенность, высокая производительность и расширяемость. Принято выделять следующие типы контрактов: контракты валидации (validation contracts), функциональные контракты (function contracts) и прикладные контракты (application contracts).

С точки зрения производительности NEO использует легкую NeoVM (виртуальная машина NEO) в качестве интеллектуальной среды для реализации смарт-контракта. Она имеет очень короткое время запуска, использует небольшой объем ресурсов и подходит для таких смарт-контрактов, как короткие процедуры. Статическую компиляцию и кэширование хот-спот контрактов можно значительно улучшить, используя технологию JIT (динамический компилятор). Настройка команд виртуальной машины NEO позволяет получить серию криптографических команд, предназначенных для повышения эффективности выполнения криптографических алгоритмов в смарт-контрактах. Кроме того, команды управления данными обеспечивают прямую поддержку массивов и сложных структур данных. Все вышеперечисленное значительно повышает производительность работы в NEO Smart Contract 2.0. 

Благодаря сочетанию высокой параллельности, динамического разбиения и слабого связывания NEO Smart Contract 2.0 способен реализовывать идею масштабируемости. Контракт, характеризуемый слабым связыванием, выполняется в виртуальной машине (виртуальная машина NEO) и взаимодействует с внешней средой посредством слоя интерактивных сервисов. Таким образом, функциональность смарт-контракта может быть во многом улучшена с помощью API слоя интерактивных сервисов.
 
## Создание смарт-контракта на любом языке

С точки зрения языка разница между NEO Smart Contract 2.0 и Ethereum понятна на интуитивном уровне: в отличие от родного языка Solidity в Ethereum, смарт-контракт NEO может быть использован напрямую практически любым языком программирования высокого уровня. Первыми поддерживаемыми языками являются C #, VB.Net, F #, Java и Kotlin. NEO предоставляет компиляторы и плагины для данных языков. Они используются для компиляции языков высокого уровня в наборы команд, поддерживаемых виртуальными машинами NEO. Первый компилятор предназначен для MSIL (промежуточный язык Microsoft), поэтому теоретически любой язык .NET и любой язык, который может быть переведен в MSIL, будут поддерживаться NEO. 

Языки, которые мы поддерживаем в данный момент:

- C#, VB.Net, F#

- Java, Kotlin
- Python

Языки, которые мы планируем поддерживать:

- C, C++, Golang

- JavaScript

Благодаря многоязычной поддержке, более 90% разработчиков могут принимать непосредственное участие в разработке смарт-контракта NEO, не нуждаясь при этом в изучении нового языка. Существующий код бизнес-системы может быть напрямую перенесен в блокчейн. Мы предполагаем, что все это значительно повысит общую популярность блокчейна в будущем. 

Помимо всего прочего, традиционные смарт-контракты непросто отлаживать и тестировать в связи с недостаточной инструментальной поддержкой и нехваткой прямого доступа к инструкциям виртуальной машины. NEO же предоставляет базовую поддержку для отладки на уровне виртуальной машины NEO, что позволяет разрабатывать NEO Smart Contract 2.0 быстрее и легче. Если вам нужны TestNet GAS, можете смело попросить у нас, и мы предоставим вам их для разработки.

## Триггеры смарт-контракта

Существуют два способа, как инициировать смарт-контракт:

1. Аутентификация пользователя контракта: в данном случае смарт-контрактом является счет контракта. Запрашивая использование счета контракта, пользователь инициирует смарт-контракт.
2. Вызов смарт-контракта вручную: пользователь отправляет транзакцию (Invocation Transaction), чтобы инициировать реализацию смарт-контракта.

## NeoVM

NeoVM – это виртуальная машина, выполняющая код смарт-контракта NEO. Мы говорим сейчас о концепции виртуальной машины в узком смысле, не ссылаясь на операционные системы или программы, которые могут имитировать ее (VMware или Hyper-V).

Например, в Java JVM или .NET CLR исходный код будет скомпилирован в соответствующий байт-код и затем запущен на соответствующей виртуальной машине. JVM или CLR будет выполнять байт-код, что аналогично выполнению команд реальным физическим компьютером. Примечательно, что соответствующие бинарные команды все еще выполняются на физическом компьютере, который извлекает команды из памяти, передает их по шине в CPU, затем декодирует, выполняет и сохраняет результат.

### Архитектура виртуальной машины

![neo-vm](../../assets/neo-vm.jpg)

На приведенной выше схеме показана системная архитектура виртуальной машины Neo (NeoVM), где развертывание в границах пунктирной рамки является сутью виртуальной машины. 

#### Виртуальный процессор (Execution engine)

Зеленым цветом в левой части схемы показан процессор виртуальной машины (эквивалент ЦП). Он может выполнять общие команды, такие как управление потоками данных, операции со стеком, битовые операции, арифметические операции, логические операции, криптографические методы и т.д. Виртуальный процессор может взаимодействовать со слоем интерактивных сервисов (описано ниже) посредством системных вызовов.

#### Стек вычислений (Evaluation stack)

Средняя часть виртуальной машины, выделенная серым цветом, - это стек вычислений (эквивалентен памяти). На сегодняшний день существуют два способа реализации виртуальной машины: 1) стековая виртуальная машина и 2) регистровая виртуальная машина. Оба способа имеют как преимущества, так и недостатки (и оба имеют примеры блестящей реализации). К виртуальным машинам, работающим на базе стека, относятся JVM, CPython и .NET CLR. Среди регистровых виртуальных машин можно выделить Dalvik и Lua5.0. В основе виртуальных машин на базе стека лежит концепция вычислительного стека, который позволяет виртуальным машинам взаимодействовать непосредственно со стеком (стек вычислений) при выполнении реальных операций. 

Поскольку виртуальная машина на базе стека производит выборку данных из стека операндов по умолчанию, указывать операнд нет никакой необходимости. Сравните такое поведение, например, с инструкциями x86 &quot;ADD EAX, EBX&quot;. Данная операция требует указания регистров с входными операндами и регистра для записи результата. Командам виртуальной машины на базе стека можно не указывать эти параметры. Например, простую операцию «ADD» можно добавить непосредственно в стек операндов. Данные могут быть напрямую удалены из стека, при этом результат сохранится на верхней позиции стека.

#### Слой совместимых сервисов (Interoperable service layer)

Синим цветом в правой стороне схемы показан слой совместимых сервисов виртуальной машины (аналог периферийных устройств). В настоящее время слой совместимых сервисов предоставляет API для доступа к блокчейну NEO. Он может получить доступ к информации о блоках, транзакциях, сделках, активах и т. д. 

Кроме того, слой совместимых сервисов предоставляет постоянное хранилище (storage) для каждого контракта. Любой смарт-контракт может иметь частное хранилище (опционально), которое существует в форме объекта «ключ-значение», определяемого вызываемым контрактом, а не контекстом постоянного хранилища. Прежде чем инициатор вызова сможет выполнить операции чтения и записи, он должен передать свой собственный контекст хранилища (storage context) вызываемому контракту (для завершения авторизации).

### Режим оплаты

Смарт-контракт может быть запрограммирован на взимание определенной комиссии, состоящей из платы за развертывание и платы за выполнение.

Плата за развертывание – это комиссия, которую платит разработчик за развертывание смарт-контракта в блокчейне (в настоящее время она составляет 500 GAS). Плата за выполнение - это комиссия, которую платит пользователь за выполнение смарт-контракта. Каждая операция имеют свою цену (при этом комиссия за проведение большинства операций равна по умолчанию 0,001 GAS). Первые 10 GAS являются бесплатными. Чтобы получить приоритет в обработке данных, можно вручную увеличить размер комиссии за выполнение. Подробнее о комиссиях смарт-контракта см. [здесь](systemfees.md#smart-contract-fees).

## Простой смарт-контракт

Вот несколько простых смарт-контрактов:

```c#
public static bool Main ()
{
    return true;
}
```

В случае с данным смарт-контрактом возвращаемое значение всегда `true`, что означает, что кто угодно может потратить активы (то есть деньги) с адреса контракта).

Клиент для работы с кошельком NEO имеет функцию удаления актива. Когда вы удаляете его, он отправляется на указанный адрес, сгенерированный вышеупомянутым смарт-контрактом. Потратить активы с этого адреса может кто угодно, поскольку они не имеют большой ценности.

```c#
public static bool Main ()
{
    return false
}
```
Возвращаемое значение контракта всегда `false`, что говорит о том, что активы данного контракта не могут быть использованы (приравнивается к уничтожению актива). Такой договор может применяться, например, к акциям компании, которые были списаны/аннулированы.


Еще больше примеров см. в:

[Hello World](tutorial/HelloWorld.md)

[Lock (lock)](tutorial/lock.md)

[Domain (Domain Name System)](tutorial/Domain.md)
