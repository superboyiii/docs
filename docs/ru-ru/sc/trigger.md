# Триггеры смарт-контракта 

Триггер смарт-контракта - это механизм, который инициирует выполнение смарт-контракта. Смарт-контракт NEO используют четыре триггера:`Verification`, `Application`， `VerificationR`, и `ApplicationR`.

### Verification

Тригер валидации необходим для вызова контракта в качестве функции верификации, которая принимает множество параметров и возвращает допустимое булево значение, указывающее на достоверность транзакции или блока.

Когда вы переводите активы со счета A на счет B, то инициируете выполнение контракта верификации. Все узлы, получившие транзакцию (включая нормальные узлы и синие узлы консенсуса), верифицируют контракт счета А. Если возвращаемое значение true, передача активов завершена успешно. Если возвращаемое значение false, передача не состоялась.

Если контракт верификации не выполнен, то транзакция не будет записана в блокчейн.

Ниже приведен пример кода для простого контракта верификации. Если условие A выполнено, он возвращает true, указывающее на то, что передача прошла успешно. В противном случае он возвращает false, сообщая о том, что передача не состоялась.

```c#
public static bool Main(byte[] signature)
{
    if (/*condition A*/)
        return true;
    else
        return false;
}
```

Опираясь на приведенный выше код, следующий код добавляет условие для определения типа работающего триггера. Только если данный триггер является триггером верификации, выполняется верификационная часть кода (полезно для сложных смарт-контрактов). Если смарт-контракт реализует несколько триггеров, то триггер должен оцениваться в методе Main.


```c#
public static bool Main(byte[] signature)
{
    if (Runtime.Trigger == TriggerType.Verification)
    {
        if (/*condition A*/)
                return true;
            else
                return false;
    }  
}
```

### Application

Прикладной триггер необходим для вызова контракта в качестве функции верификации, которая может принимать несколько параметров, изменять состояние блокчейна и возвращать значения любого типа.

Теоретически, смарт-контракты могут иметь любые точки входа, но для более легкого вызова мы рекомендуем использовать в этом качестве основную функцию.

```c#
public static Object Main(string operation, params object[] args) 
```

Ниже представлен простой контракт, использующий прикладной триггер.

```c#
public static Object Main(string operation, params object[] args)
{
    if (Runtime.Trigger == TriggerType.Application)
    {
        if (operation == "FunctionA") return FunctionA(args);
        if (operation == "FunctionB") return FunctionB(args);
        if (operation == "FunctionC") return FunctionC(args);
    }  
}
public static bool FunctionA(params object[] args)
{
    //some code  
}
public static BigInteger FunctionB(params object[] args)
{
    //some code  
}
public static byte[] FunctionC(params object[] args)
{
    //some code  
}
```

В отличие от триггера верификации, который инициируется передачей, прикладной триггер запускается специальной транзакцией `InvocationTransaction`. Когда приложение (Web / App) вызывает смарт-контракт, создается транзакция `InvocationTransaction`, которая затем подписывается и транслируется в программе. После подтверждения транзакции `InvocationTransaction` узел консенсуса начинает реализацию смарт-контракта. Общий узел не выполняет смарт-контракт, когда пересылает транзакцию.

Поскольку прикладной контракт реализуется после подтверждения` InvocationTransaction`, транзакция записывается в блокчейн независимо от того, успешно ли выполнен прикладной контракт или нет.

Успешное или неудачное проведение `InvocationTransaction` не обязательно связаны с успешным или неудачным выполнением смарт-контрактов.

### VerificationR

Будет добавлен. Дополнительную информацию по VerificationR см[here](https://github.com/neo-project/proposals/blob/597f0dc53a80bbedb14974c8168f8df288c1d82e/nep-7.mediawiki) .

### ApplicationR

Будет добавлен. Дополнительную информацию по ApplicationR см.[here](https://github.com/neo-project/proposals/blob/597f0dc53a80bbedb14974c8168f8df288c1d82e/nep-7.mediawiki) .

### Несколько триггеров в смарт-контракте 

Для того чтобы соответствовать разным контекстам, смарт-контракт может содержать несколько триггеров. Следующий код содержит как триггер верификации, так и прикладной триггер.

```c#
public static Object Main(string operation, params object[] args)
{
    if (Runtime.Trigger == TriggerType.Verification)
    {
        if (/*condition A*/)
                return true;
            else
                return false;
    }  
    if (Runtime.Trigger == TriggerType.Application)
    {
        if (operation == "FunctionA") return FunctionA(args);
    }  
}

public static bool FunctionA(params object[] args)
{
    //some code  
}
```

### Сравнение триггеров 

Ниже представлена сравнительная таблица по данным триггерам смарт-контракта.

|                    | Verification                                                 | Application                                                  | VerificationR                                                | ApplicationR                                                 |
| ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Name               | Триггер верификации                                         | Прикладной триггер trigger                                          | TBD                                                          | TBD                                                          |
| Status             | Разработка завершена                                        | Разработка завершена                                        | Разработка завершена                                        | Разработка завершена                                        |
| Trigger method     | Активируется при отправке передачи                             | Активируется при отправке InvocationTransaction                 | Активируется при получении передачи                          | Активируется при получении передачи                          |
| Выполнение контракта | Сначала выполняет смарт-контракт, а затем подтверждает транзакцию | Сначала подтверждает транзакцию, а затем выполняет смарт-контракт | Сначала выполняет смарт-контракт, а затем подтверждает транзакцию | Сначала подтверждает транзакцию, а затем выполняет смарт-контракт |
| Возвращаемое значение       | Boolean                                                      | Любое                                                          | Boolean                                                      | Любое                                                          |
| Хранилище контракта   | Только чтение                                                    | Чтение и запись                                                | Только чтение                                                    | Чтение и запись                                                |

